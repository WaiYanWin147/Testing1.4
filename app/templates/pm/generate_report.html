{% extends "base.html" %}

{% block title %}Generate Report - Platform Manager{% endblock %}

{% block nav_links %}
<a href="{{ url_for('boundary.pm_dashboard') }}" class="text-gray-700 hover:text-primary">Dashboard</a>
<a href="{{ url_for('boundary.pm_categories') }}" class="text-gray-700 hover:text-primary">Manage Categories</a>
<a href="{{ url_for('boundary.pm_reports') }}" class="text-primary font-medium">Reports</a>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Generate Report</h1>
    <p class="text-gray-600 mt-2">Create a comprehensive system report.</p>
  </div>

  <div class="bg-white rounded-lg shadow p-6">
    <form method="POST" action="{{ url_for('boundary.pm_generate_report') }}">
      <div class="space-y-4">

        <div>
          <label for="report_type" class="block text-sm font-medium text-gray-700 mb-1">Report Type *</label>
          <select id="report_type" name="report_type" required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
            <option value="">Select type...</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <div>
          <label for="period" class="block text-sm font-medium text-gray-700 mb-1">Period *</label>
          <!-- We will toggle this input's type/placeholder via JS -->
          <input type="text" id="period" name="period" required
                 placeholder="e.g., 2025-10-27 (daily), 2025-10-20 (weekly start), 2025-10 (monthly)"
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p class="text-sm text-blue-800">
            <strong>Note:</strong> Use the correct format:
          </p>
          <ul class="list-disc pl-5 mt-1 text-sm text-blue-800 space-y-1">
            <li><b>Daily:</b> <code>YYYY-MM-DD</code> (e.g. <code>2025-10-27</code>)</li>
            <li><b>Weekly:</b> Enter the <u>start date</u> of the week in <code>YYYY-MM-DD</code> (e.g. <code>2025-10-20</code>). The report covers 7 days from this date.</li>
            <li><b>Monthly:</b> <code>YYYY-MM</code> (e.g. <code>2025-10</code>)</li>
          </ul>
        </div>

        <div class="flex gap-4 pt-4">
          <button type="submit"
                  class="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition">
            Generate Report
          </button>
          <a href="{{ url_for('boundary.pm_reports') }}"
             class="flex-1 text-center bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition">
            Cancel
          </a>
        </div>
      </div>
    </form>
  </div>

  <div class="mt-6">
    <a href="{{ url_for('boundary.pm_reports') }}" class="text-primary hover:text-blue-700">
      ‚Üê Back to Reports
    </a>
  </div>
</div>

<!-- Enhancement: switch input type & placeholder by report type -->
<script>
(function () {
  const typeSel = document.getElementById('report_type');
  const period  = document.getElementById('period');

  function setForDaily() {
    period.type = 'date';
    period.placeholder = 'e.g. 2025-10-27';
    period.value = '';
    period.pattern = '';       // no pattern when using date type
  }
  function setForWeekly() {
    period.type = 'date';      // start date only
    period.placeholder = 'Weekly start date, e.g. 2025-10-20';
    period.value = '';
    period.pattern = '';
  }
  function setForMonthly() {
    // Use text + pattern; some browsers support type='month'
    period.type = 'text';
    period.placeholder = 'e.g. 2025-10';
    period.value = '';
    period.pattern = '^\\d{4}-\\d{2}$';
  }

  typeSel.addEventListener('change', function () {
    if (this.value === 'daily')  setForDaily();
    if (this.value === 'weekly') setForWeekly();
    if (this.value === 'monthly') setForMonthly();
  });
})();
</script>
{% endblock %}
